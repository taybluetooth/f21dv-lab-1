<!--
Author: Callum Taylor
Filename: lab1.html
License: MIT Open Source License
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <script>
      // Exercise 1:

      const exercise1 = () => {
        // Version 7.3.0 shows
        console.log("d3.version:", d3.version);
      };

      // Exercise 2:

      const exercise2 = () => {
        // Create HTML elements programatically
        // Classed adds class selector to element
        d3.select("body")
          .append("p")
          .classed("p1", true)
          .text("First paragraph");
        d3.select("body").append("p").text("Second paragraph");

        d3.selectAll("p")
          .style("color", "blue")
          .style("font-size", "20px")
          .style("font-family", "sans-serif")
          .style("line-height", "8px");

        d3.select(".p1").style("text-decoration", "underline");
      };

      // Exercise 3:

      const exercise3 = () => {
        for (var i = 0; i < 10; i++) {
          if (i < 5) {
            d3.select("body")
              .append("div")
              .text(i + 1)
              .style("color", "red");
          } else if (i >= 5) {
            d3.select("body")
              .append("div")
              .text(i + 1)
              .style("color", "green");
          }
        }
      };

      // Exercise 4:

      const exercise4 = () => {
        d3.selectAll("div")
          .filter(function () {
            return d3.select(this).text() == 1;
          })
          .text("Start")
          .style("color", "purple");
      };

      // Exercise 5:

      const exercise5 = () => {
        d3.select("body")
          .append("div")
          .text("Hello World!")
          .style("color", "green");
      };

      // Exercise 6:

      const exercise6 = () => {
        // Create HTML elements programatically

        for (var i = 0; i < 3; i++) {
          d3.select("body").append("div");
        }

        let otherdata = [
          { name: "test", val: 1, color: "blue" },
          { name: "other", val: 2, color: "red" },
          { name: "b", val: 3, color: "green" },
        ];

        let paragraph = d3
          .select("body")
          .selectAll("div")
          .data(otherdata)
          .text(function (d, i) {
            console.log("d.name: " + d.name);
            console.log("d.val:  " + d.val);
            console.log("d.color " + d.color);
            console.log("i: " + i);
            console.log("this: " + this);

            return "cont:" + d.name;
          });
      };

      // Exercise 7:

      const exercise7 = () => {
        // Create HTML elements programatically

        for (var i = 0; i < 4; i++) {
          d3.select("body").append("div");
        }

        let num = [10, 50, 100, 200];

        let paragraph = d3
          .select("body")
          .selectAll("div")
          .data(num)
          .text(function (d, i) {
            return "cont:" + d;
          })
          .style("color", function (d, i) {
            if (d >= 50 && d <= 100) {
              return "red";
            } else {
              return "yellow";
            }
            return "blue";
          });
      };

      // Exercise 8:

      const exercise8 = () => {
        var myData = ["a", 4, 1, "b", 6, 2, 8, 9, "z"];

        var p = d3
          .select("body")
          .selectAll("span")
          .data(myData)
          .enter()
          .append("span")
          .style("color", function (d, i) {
            // JS has no char type
            // Will check if string and length 1
            if (typeof d == "string" && d.length == 1) {
              return "blue";
            } else if (typeof d == "number") {
              return "green";
            }
          })
          .text(function (d, i) {
            return d;
          });
      };

      // Exercise 9:
      // Titles without . include passenger siblings
      // Not all passengers have a title

      const exercise9 = async () => {
        const titaniccsv =
          "https://raw.githubusercontent.com/dsindy/kaggle-titanic/master/data/test.csv";
        const titles = [
          { title: "Mr.", num: 0 },
          { title: "Master.", num: 0 },
          { title: "Mrs.", num: 0 },
          { title: "Miss.", num: 0 },
        ];

        const genders = [
          { sex: "Male", num: 0 },
          { sex: "Female", num: 0 },
        ];

        const data = await d3.csv(titaniccsv);

        // Count titles
        data.forEach((entry) => {
          titles.forEach((count) => {
            if (entry.Name.includes(count.title)) {
              count.num++;
            }
          });
        });

        // Count genders
        data.forEach((entry) => {
          genders.forEach((count) => {
            if (entry.Sex === count.sex.toLowerCase()) {
              count.num++;
            }
          });
        });

        // Print titles
        titles.forEach((count) => {
          console.log(count.title + ": " + count.num);
        });

        // Print genders
        genders.forEach((count) => {
          console.log(count.sex + ": " + count.num);
        });
      };

      // Exercise 10:

      const exercise10 = async () => {
        let heartfailurecsv =
          "https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv";

        // Object to hold ages
        let ageCount = [
          { label: "1-30", count: 0 },
          { label: "31-40", count: 0 },
          { label: "41-60", count: 0 },
          { label: "61-100", count: 0 },
        ];

        // Temp storage array for ages
        let arr = [];

        // Fetch data from csv
        const data = await d3.csv(heartfailurecsv);

        // Parse data and process ages into temp array
        data.forEach((entry) => {
          arr.push(entry.age);
        });

        // Divide ages into their own categories
        arr.forEach((entry) => {
          if (entry >= 1 && entry <= 30) {
            ageCount[0].count += 1;
          } else if (entry >= 31 && entry <= 40) {
            ageCount[1].count += 1;
          } else if (entry >= 41 && entry <= 60) {
            ageCount[2].count += 1;
          } else if (entry >= 61 && entry <= 100) {
            ageCount[3].count += 1;
          }
        });

        // Create HTML elements programatically
        for (var i = 0; i < 4; i++) {
          d3.select("body").append("p");
        }

        // Add data to paragraphs
        var p = d3
          .select("body")
          .selectAll("p")
          .data(ageCount)
          .text(function (d, i) {
            return d.label + ": " + d.count;
          });
      };

      const exercise11 = () => {
        // Create SVG element
        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", 400)
          .attr("height", 400)
          .style("border", "1px solid green");

        // Create line elements inside SVG to form square
        svg
          .append("line")
          .attr("stroke", "blue")
          .attr("x1", 100)
          .attr("x2", 200)
          .attr("y1", 100)
          .attr("y2", 100);

        svg
          .append("line")
          .attr("stroke", "red")
          .attr("x1", 200)
          .attr("x2", 200)
          .attr("y1", 100)
          .attr("y2", 200);

        svg
          .append("line")
          .attr("stroke", "purple")
          .attr("x1", 200)
          .attr("x2", 100)
          .attr("y1", 200)
          .attr("y2", 200);

        svg
          .append("line")
          .attr("stroke", "green")
          .attr("x1", 100)
          .attr("x2", 100)
          .attr("y1", 200)
          .attr("y2", 100);
      };

      const exercise12 = async () => {
        let svgcsv =
          "https://raw.githubusercontent.com/taybluetooth/f21dv-lab-1/main/svgtest.csv";
        let arr = [];

        const csv = await d3.csv(svgcsv);

        csv.forEach((data) => {
          arr.push({
            shape: data.shape,
            dim: data.dim,
            position: data.position,
            color: data.color,
          });
        });

        console.log(arr);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", 400)
          .attr("height", 400)
          .style("border", "1px solid green");

        arr.forEach((entry) => {
          switch (entry.shape.toLowerCase()) {
            case "circle":
              let dim = entry.dim.split(",");
              svg
                .append(entry.shape)
                .attr("stroke", entry.color)
                .attr("cx", dim[0])
                .attr("cy", dim[1])
                .attr("r", entry.position)
              break;
          }
        });
      };

      exercise12();
    </script>
  </body>
</html>
