<!--
Author: Callum Taylor
Filename: lab1.html
License: MIT Open Source License
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <style>
      svg text {
        fill: white;
        font: 10px sans-serif;
        text-anchor: end;
      }
    </style>
    <script>
      // Exercise 1:

      const exercise1 = () => {
        // Version 7.3.0 shows
        console.log("d3.version:", d3.version);
      };

      // Exercise 2:

      const exercise2 = () => {
        // Create HTML elements programatically
        // Classed adds class selector to element
        d3.select("body")
          .append("p")
          .classed("p1", true)
          .text("First paragraph");
        d3.select("body").append("p").text("Second paragraph");

        d3.selectAll("p")
          .style("color", "blue")
          .style("font-size", "20px")
          .style("font-family", "sans-serif")
          .style("line-height", "8px");

        d3.select(".p1").style("text-decoration", "underline");
      };

      // Exercise 3:

      const exercise3 = () => {
        for (var i = 0; i < 10; i++) {
          if (i < 5) {
            d3.select("body")
              .append("div")
              .text(i + 1)
              .style("color", "red");
          } else if (i >= 5) {
            d3.select("body")
              .append("div")
              .text(i + 1)
              .style("color", "green");
          }
        }
      };

      // Exercise 4:

      const exercise4 = () => {
        d3.selectAll("div")
          .filter(function () {
            return d3.select(this).text() == 1;
          })
          .text("Start")
          .style("color", "purple");
      };

      // Exercise 5:

      const exercise5 = () => {
        d3.select("body")
          .append("div")
          .text("Hello World!")
          .style("color", "green");
      };

      // Exercise 6:

      const exercise6 = () => {
        // Create HTML elements programatically

        for (var i = 0; i < 3; i++) {
          d3.select("body").append("div");
        }

        let otherdata = [
          { name: "test", val: 1, color: "blue" },
          { name: "other", val: 2, color: "red" },
          { name: "b", val: 3, color: "green" },
        ];

        let paragraph = d3
          .select("body")
          .selectAll("div")
          .data(otherdata)
          .text(function (d, i) {
            console.log("d.name: " + d.name);
            console.log("d.val:  " + d.val);
            console.log("d.color " + d.color);
            console.log("i: " + i);
            console.log("this: " + this);

            return "cont:" + d.name;
          });
      };

      // Exercise 7:

      const exercise7 = () => {
        // Create HTML elements programatically

        for (var i = 0; i < 4; i++) {
          d3.select("body").append("div");
        }

        let num = [10, 50, 100, 200];

        let paragraph = d3
          .select("body")
          .selectAll("div")
          .data(num)
          .text(function (d, i) {
            return "cont:" + d;
          })
          .style("color", function (d, i) {
            if (d >= 50 && d <= 100) {
              return "red";
            } else {
              return "yellow";
            }
            return "blue";
          });
      };

      // Exercise 8:

      const exercise8 = () => {
        var myData = ["a", 4, 1, "b", 6, 2, 8, 9, "z"];

        var p = d3
          .select("body")
          .selectAll("span")
          .data(myData)
          .enter()
          .append("span")
          .style("color", function (d, i) {
            // JS has no char type
            // Will check if string and length 1
            if (typeof d == "string" && d.length == 1) {
              return "blue";
            } else if (typeof d == "number") {
              return "green";
            }
          })
          .text(function (d, i) {
            return d;
          });
      };

      // Exercise 9:
      // Titles without . include passenger siblings
      // Not all passengers have a title

      const exercise9 = async () => {
        const titaniccsv =
          "https://raw.githubusercontent.com/dsindy/kaggle-titanic/master/data/test.csv";
        const titles = [
          { title: "Mr.", num: 0 },
          { title: "Master.", num: 0 },
          { title: "Mrs.", num: 0 },
          { title: "Miss.", num: 0 },
        ];

        const genders = [
          { sex: "Male", num: 0 },
          { sex: "Female", num: 0 },
        ];

        const data = await d3.csv(titaniccsv);

        // Count titles
        data.forEach((entry) => {
          titles.forEach((count) => {
            if (entry.Name.includes(count.title)) {
              count.num++;
            }
          });
        });

        // Count genders
        data.forEach((entry) => {
          genders.forEach((count) => {
            if (entry.Sex === count.sex.toLowerCase()) {
              count.num++;
            }
          });
        });

        // Print titles
        titles.forEach((count) => {
          console.log(count.title + ": " + count.num);
        });

        // Print genders
        genders.forEach((count) => {
          console.log(count.sex + ": " + count.num);
        });
      };

      // Helper function for exercise 10:

      const exercise10help = async () => {
        let heartfailurecsv =
          "https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv";

        // Object to hold ages
        let ageCount = [
          { label: "1-30", count: 0 },
          { label: "31-40", count: 0 },
          { label: "41-60", count: 0 },
          { label: "61-100", count: 0 },
        ];

        // Temp storage array for ages
        let arr = [];

        // Fetch data from csv
        const data = await d3.csv(heartfailurecsv);

        // Parse data and process ages into temp array
        data.forEach((entry) => {
          arr.push(entry.age);
        });

        // Divide ages into their own categories
        arr.forEach((entry) => {
          if (entry >= 1 && entry <= 30) {
            ageCount[0].count += 1;
          } else if (entry >= 31 && entry <= 40) {
            ageCount[1].count += 1;
          } else if (entry >= 41 && entry <= 60) {
            ageCount[2].count += 1;
          } else if (entry >= 61 && entry <= 100) {
            ageCount[3].count += 1;
          }
        });

        return ageCount;
      };

      // Exercise 10:

      const exercise10 = async () => {
        const ageCount = await exercise10help();

        // Create HTML elements programatically
        for (var i = 0; i < 4; i++) {
          d3.select("body").append("p");
        }

        // Add data to paragraphs
        var p = d3
          .select("body")
          .selectAll("p")
          .data(ageCount)
          .text(function (d, i) {
            return d.label + ": " + d.count;
          });
      };

      // Exercise 11:

      const exercise11 = () => {
        // Create SVG element
        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", 400)
          .attr("height", 400)
          .style("border", "1px solid green");

        // Create line elements inside SVG to form square
        svg
          .append("line")
          .attr("stroke", "blue")
          .attr("x1", 100)
          .attr("x2", 200)
          .attr("y1", 100)
          .attr("y2", 100);

        svg
          .append("line")
          .attr("stroke", "red")
          .attr("x1", 200)
          .attr("x2", 200)
          .attr("y1", 100)
          .attr("y2", 200);

        svg
          .append("line")
          .attr("stroke", "purple")
          .attr("x1", 200)
          .attr("x2", 100)
          .attr("y1", 200)
          .attr("y2", 200);

        svg
          .append("line")
          .attr("stroke", "green")
          .attr("x1", 100)
          .attr("x2", 100)
          .attr("y1", 200)
          .attr("y2", 100);
      };

      // Exercise 12:

      const exercise12 = async () => {
        let svgcsv =
          "https://raw.githubusercontent.com/taybluetooth/f21dv-lab-1/main/svgtest.csv";
        let arr = [];

        const csv = await d3.csv(svgcsv);

        csv.forEach((data) => {
          arr.push({
            shape: data.shape,
            dim: data.dim,
            position: data.position,
            color: data.color,
          });
        });

        console.log(arr);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", 400)
          .attr("height", 400)
          .style("border", "1px solid green");

        let dim = [];
        let pos = [];

        arr.forEach((entry) => {
          switch (entry.shape.toLowerCase()) {
            case "circle":
              dim = entry.dim.split(",");
              svg
                .append(entry.shape)
                .attr("stroke", entry.color)
                .attr("fill", entry.color)
                .attr("cx", dim[0])
                .attr("cy", dim[1])
                .attr("r", entry.position);
              break;
            case "ellipse":
              dim = entry.dim.split(",");
              pos = entry.position.split(",");
              svg
                .append(entry.shape)
                .attr("stroke", entry.color)
                .attr("fill", entry.color)
                .attr("cx", dim[0])
                .attr("cy", dim[1])
                .attr("rx", pos[0])
                .attr("ry", pos[1]);
              break;
            case "line":
              dim = entry.dim.split(",");
              svg
                .append(entry.shape)
                .attr("stroke", entry.color)
                .attr("x1", dim[0])
                .attr("y1", dim[1])
                .attr("x2", dim[2])
                .attr("y2", dim[3]);
              break;
            case "rect":
              dim = entry.dim.split(",");
              pos = entry.position.split(",");
              svg
                .append(entry.shape)
                .attr("stroke", entry.color)
                .attr("fill", entry.color)
                .attr("x", pos[0])
                .attr("y", pos[1])
                .attr("width", dim[1])
                .attr("height", dim[0]);
              break;
          }
        });
      };

      // Exercise 13:

      const exercise13 = () => {};

      // Exercise 14:

      const exercise14 = async () => {
        var arr = await exercise10help();

        var data = [];

        arr.forEach((entry) => {
          data.push(entry.count);
        });

        var width = 1000;
        var scaleFactor = 5;
        var barHeight = 20;

        var graph = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", barHeight * data.length);

        var bar = graph
          .selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0," + i * barHeight + ")";
          })
          .style("fill", "blue");

        bar
          .append("rect")
          .attr("width", function (d) {
            return d * scaleFactor;
          })
          .attr("height", barHeight - 1);

        bar
          .append("text")
          .attr("x", function (d) {
            return d * scaleFactor;
          })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function (d) {
            return d;
          });
      };

      // Exercise 15:

      exercise15 = async () => {
        var arr = await exercise10help();

        var data = [];

        arr.forEach((entry) => {
          data.push(entry.count);
        });

        var width = 1000;
        var scaleFactor = 5;
        var barHeight = 20;

        var graph = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", barHeight * data.length);

        var bar = graph
          .selectAll("g")
          .data(arr)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0," + i * barHeight + ")";
          })
          .style("fill", function (d, i) {
            if (d.label == "1-30") {
              return "black";
            }
            if (d.label == "31-40") {
              return "red";
            }
            if (d.label == "41-60") {
              return "darkorange";
            }
            if (d.label == "61-100") {
              return "blue";
            }
          });

        bar
          .append("rect")
          .attr("width", function (d) {
            return d.count * scaleFactor;
          })
          .attr("height", barHeight - 1);

        bar
          .append("text")
          .attr("x", function (d) {
            return d.count * scaleFactor;
          })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function (d) {
            return d.count;
          });
      };

      // Exercise 16:

      const exercise16 = () => {
        const width = 500;
        const height = 500;

        const data = [10, 15, 20, 25, 30];
        // Note different valid ways of specifying color
        const colors = ["#ffffcc", "red", "rgb(0,255,0)", "#31a354", "#006837"];

        const svg = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        const g = svg
          .selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0,0)";
          });

        g.append("circle")
          .attr("cx", function (d, i) {
            return i * 100 + 50;
          })
          .attr("cy", function (d, i) {
            return 100;
          })
          .attr("r", function (d) {
            return d * 1.5;
          })
          .attr("fill", function (d, i) {
            return colors[i];
          });

        g.append("rect")
          .attr("width", function (d, i) {
            return d * 1 + 50;
          })
          .attr("height", function (d, i) {
            return d * 1 + 50;
          })
          .attr("x", function (d, i) {
            return i * 100;
          })
          .attr("y", function (d) {
            return 300;
          })
          .attr("fill", function (d, i) {
            return colors[i];
          });

        g.append("text")
          .attr("x", function (d, i) {
            return i * 100 + 40;
          })
          .attr("y", 105)
          .attr("stroke", "teal")
          .attr("font-size", "12px")
          .attr("font-family", "sans-serif")
          .text(function (d) {
            return d;
          });

        g.append("text")
          .attr("x", function (d, i) {
            return i * 100 + 40;
          })
          .attr("y", 350)
          .attr("stroke", "teal")
          .attr("font-size", "12px")
          .attr("font-family", "sans-serif")
          .text(function (d) {
            return d;
          });
      };

      // Exercise 17:

      const exercise17 = () => {
        const data = [50, 400, 300, 900, 250, 1000];

        const width = 500;
        const barHeight = 20;
        const margin = 1;

        var scale = d3
          .scaleLinear()
          .domain([d3.min(data), d3.max(data)])
          .range([50, 500]);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", barHeight * data.length);

        var g = svg
          .selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0," + i * barHeight + ")";
          });

        g.append("rect")
          .attr("width", function (d) {
            return scale(d);
          })
          .attr("fill", function (d, i) {
            if (d < 100) {
              return "green";
            } else if (d > 500) {
              return "red";
            } else {
              return "blue";
            }
          })
          .attr("height", barHeight - margin);

        g.append("text")
          .attr("x", function (d) {
            return scale(d);
          })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function (d) {
            return d;
          });
      };

      // Exercise 18:

      const exercise18 = async () => {
        const path =
          "https://raw.githubusercontent.com/taybluetooth/f21dv-lab-1/main/ex18.csv";
        const csv = await d3.csv(path);

        const width = 500;
        const barHeight = 20;
        const margin = 1;

        const data = [];
        csv.forEach((entry) => {
          data.push(parseInt(entry.value));
        });

        var scale = d3
          .scaleLinear()
          .domain([d3.min(data), d3.max(data)])
          .range([50, 500]);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", barHeight * data.length);

        var g = svg
          .selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0," + i * barHeight + ")";
          });

        g.append("rect")
          .attr("width", function (d) {
            return scale(d);
          })
          .attr("fill", "blue")
          .attr("height", barHeight - margin);

        g.append("text")
          .attr("x", function (d) {
            return scale(d);
          })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function (d) {
            return d;
          });
      };

      // Exercise 19:

      const exercise19 = async (path) => {
        const csv = await d3.csv(path);

        const width = 500;
        const barHeight = 20;
        const margin = 1;

        const data = [];
        csv.forEach((entry) => {
          data.push(parseInt(entry.value));
        });

        var scale = d3
          .scaleLinear()
          .domain([d3.min(data), d3.max(data)])
          .range([50, 500]);

        var svg = d3
          .select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", barHeight * data.length);

        var g = svg
          .selectAll("g")
          .data(data)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return "translate(0," + i * barHeight + ")";
          });

        g.append("rect")
          .attr("width", function (d) {
            return scale(d);
          })
          .attr("fill", "blue")
          .attr("height", barHeight - margin);

        g.append("text")
          .attr("x", function (d) {
            return scale(d);
          })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function (d) {
            return d;
          });
      };

      const testExercise19 = () => {
        exercise19(
          "https://raw.githubusercontent.com/taybluetooth/f21dv-lab-1/main/ex18.csv"
        );
        exercise19(
          "https://raw.githubusercontent.com/taybluetooth/f21dv-lab-1/main/ex19.csv"
        );
      };

      // Exercise 20:

      exercise20 = () => {};

      // Exercise 21:

      exercise21 = () => {};

      // Exercise 22:

      exercise22 = () => {};

      // Exercise 23:

      exercise23 = () => {};

      // Exercise 24:

      exercise24 = () => {};

      // Exercise 25:

      exercise25 = () => {};

      // Exercise 26:

      exercise26 = () => {};

      // Exercise 27:

      exercise27 = () => {};

      // Exercise 28:

      exercise28 = () => {};

      // Exercise 29:

      exercise29 = () => {};

      // Exercise 30:

      exercise30 = () => {};

      // Exercise 31:

      exercise31 = () => {};

      // Exercise 32:

      exercise32 = () => {};
    </script>
  </body>
</html>
